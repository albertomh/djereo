<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Alberto Morón Hernández" /><link rel="canonical" href="https://albertomh.github.io/djereo/featurelist/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Djereo's features - Djereo documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Djereo\u0027s features";
        var mkdocs_page_input_path = "featurelist.md";
        var mkdocs_page_url = "/djereo/featurelist/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../media/djereo_wordmark-logo.webp" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Djereo's features</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setup-questionnaire">☑️ Setup questionnaire</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#versions">Versions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#django-version">Django version</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#python-version">Python version</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#postgres-version">Postgres version</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#semantic-versioning">🚦 Semantic Versioning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#git-pre-commit-hooks">🪝 Git pre-commit hooks</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#optional-github-features">Optional GitHub features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#custom-github-actions">Custom GitHub actions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#github-actions-workflows">GitHub Actions workflows</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#pr-pull-request">PR (pull request)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#ci-continuous-integration">CI (continuous integration)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#release-please">Release Please</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#dependabot">Dependabot</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#justfile">🤖 Justfile</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#developer-experience-enhancements">💻 Developer Experience enhancements</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#use-ipython-as-your-shell">Use IPython as your shell</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#developer-tools">Developer tools</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#custom-system-checks">Custom system checks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#use-project-metadata-in-the-django-app">Use project metadata in the Django app</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#settingspy">⚙️ settings.py</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#logging">🪵 Logging</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#models">Models</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#postgres-database">🐘 Postgres database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#set-up-tear-down-scripts">Set up &amp; tear down scripts</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#database-connection-string">Database connection string</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#connection-pooling">Connection pooling</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#seed_database-management-command">seed_database management command</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#user-authentication">🆔 User authentication</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#users-app-model-factories">users app model factories</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#frontend">Frontend</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#default-pages-styling">Default pages &amp; styling</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#styling-django-allauth-templates">Styling django-allauth templates</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#optional-htmx-frontend">Optional htmx frontend</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#third-party-packages">🤝 Third-party packages</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#whitenoise">whitenoise</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security">🔒 Security</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tests">🧪 Tests</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deployment">🚀 Deployment</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#healthchecks">Healthchecks</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../develop/">Developer docs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="https://github.com/albertomh/djereo/blob/main/CHANGELOG.md">Changelog ↗</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Djereo documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Djereo's features</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/albertomh/djereo/edit/main/docs/src/featurelist.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <!-- markdownlint-disable MD033 no-inline-html -->
<h1 id="djereos-features">Djereo's features</h1>
<p><code>djereo</code> is a Django project template with opinionated tooling.</p>
<p>When invoked by following the instructions in the <a href="../quickstart/">Quickstart</a> the user
is prompted to answer questions and make choices via a CLI. These answers are used to
create a ready-to-use opinionated Django project.</p>
<p>This page documents the features of a Django project as generated by <code>djereo</code>.</p>
<h2 id="setup-questionnaire">☑️ Setup questionnaire</h2>
<p><a href="https://github.com/albertomh/djereo/blob/main/copier.yaml" target="\&quot;_blank&quot;">copier.yaml</a>
defines the questionnaire that <code>copier</code> will use to prompt the user when setting up a new
project. The questions defined in this file include sensible defaults (where appropriate)
and validation rules to prevent incoherent answers.</p>
<div class="admonition note">
<p class="admonition-title">Options? - I thought this was an opinionated template!</p>
<p><code>djereo</code> is opinionated insofar as it embodies beliefs such as 'postgres is the best
database for a new project' or 'htmx for frontends is great'. It lays out paved paths
and sensible defaults if you choose to configure a new project with these tools. The
aim isn't to be restrictive or force e.g. <code>htmx</code> or <code>django-waffle</code> on anyone.</p>
</div>
<h3 id="versions">Versions</h3>
<p>Users are asked three version-related questions when initialising a project:</p>
<h4 id="django-version">Django version</h4>
<p><a href="https://docs.djangoproject.com/en/stable/" target="\&quot;_blank&quot;">Django</a> is a popular web
framework written in Python. <code>djereo</code> gives you the choice between creating projects using
Django versions:</p>
<ul>
<li>5.1 (latest)</li>
<li>4.2 (LTS, long-term support version)</li>
</ul>
<p>See <a href="https://endoflife.date/django" target="\&quot;_blank&quot;">https://endoflife.date/django</a> for
more information.</p>
<h4 id="python-version">Python version</h4>
<p><code>djereo</code> (and its base, <a href="https://github.com/albertomh/pycliche" target="\&quot;_blank&quot;">pycliche</a>)
support Python 3.10 and above. The user's choice is recorded in a <a href="https://github.com/albertomh/djereo/blob/main/template/.python-version.jinja" target="\&quot;_blank&quot;">.python-version</a>
file and in the <code>requires-python</code> field of <a href="https://github.com/albertomh/djereo/blob/main/template/pyproject.toml.jinja" target="\&quot;_blank&quot;">pyproject.toml</a>.</p>
<p>See <a href="https://endoflife.date/python" target="\&quot;_blank&quot;">https://endoflife.date/python</a> for
more information.</p>
<h4 id="postgres-version">Postgres version</h4>
<p><code>djereo</code> is configured to work with a postgres database and contains utilities and checks
to help with this. See <a href="#postgres-database">Postgres database</a> below for more information.</p>
<p>Note that it is trivial to switch from postgres to SQLite (a single-line change in <code>.env.in</code>)
if you prefer that database engine.</p>
<div class="admonition note">
<p class="admonition-title">Keeping versions consistent</p>
<p>The <code>django-version-checks</code> package is used to ensure all environments (local, CI, dev,
prod) use the same versions of Python &amp; postgres.</p>
</div>
<h2 id="semantic-versioning">🚦 Semantic Versioning</h2>
<p>The generated project follows Semantic Versioning, with users prompted to provide an
initial version at project setup. The project's version is tracked in the <code>version</code> field
of <a href="https://github.com/albertomh/djereo/blob/main/template/pyproject.toml.jinja" target="\&quot;_blank&quot;">pyproject.toml</a>.</p>
<p>See <a href="#release-please">Release Please</a> below for information on how this version can be used
alongside Conventional Commits to automatically generate changelogs and new semver tags.</p>
<p>See <a href="https://semver.org/" target="\&quot;_blank&quot;">https://semver.org/</a> for more information.</p>
<h2 id="git-pre-commit-hooks">🪝 Git pre-commit hooks</h2>
<p>Every new project comes with a set of sensible <a href="https://pre-commit.com/" target="\&quot;_blank&quot;">pre-commit</a>
git hooks. These are defined in <a href="https://github.com/albertomh/djereo/blob/main/template/.pre-commit-config.yaml.jinja" target="\&quot;_blank&quot;">.pre-commit-config.yaml</a>
and include:</p>
<ul>
<li>Common core hooks such as <code>check-merge-conflict</code> or <code>end-of-file-fixer</code>.</li>
<li><code>mypy</code> to perform static type checks on Python code.</li>
<li><code>asottile/pyupgrade</code> to convert syntax when the version of Python is upgraded.</li>
<li><code>astral-sh/ruff-pre-commit</code> to lint &amp; format Python code at lightspeed with Ruff. Check
  the <code>tool.ruff.lint</code> table in <code>pyproject.toml</code> for a full list of rules and options.</li>
<li><code>DavidAnson/markdownlint-cli2</code> to lint markdown files with rules configured in <a href="https://github.com/albertomh/djereo/blob/main/template/.markdownlint-cli2.yaml" target="\&quot;_blank&quot;">.markdownlint-cli2.yaml</a>.</li>
<li><code>biomejs/pre-commit</code> to lint &amp; format frontend code (JS, TS, CSS) following config in <a href="https://github.com/albertomh/djereo/blob/main/template/biome.jsonc" target="\&quot;_blank&quot;">biome.jsonc</a>.</li>
<li><code>adamchainz/djade-pre-commit</code> to format Django templates.</li>
<li><code>adamchainz/django-upgrade</code> to automatically migrate code to a new version of Django.</li>
<li><code>alessandrojcm/commitlint-pre-commit-hook</code> to enforce <a href="https://www.conventionalcommits.org/en/v1.0.0/" target="\&quot;_blank&quot;">Conventional Commits</a>.</li>
</ul>
<!-- markdownlint-disable MD013 line-length -->
<h2 id="optional-github-features"><img src="https://simpleicons.org/icons/github.svg" width="25" alt="GitHub logo"> Optional GitHub features</h2>
<!-- markdownlint-enable MD013 line-length -->

<p>As part of the setup questionnaire users are asked whether the project they are creating
will be hosted on GitHub. If this is the case, GitHub Actions config files are added to
their project. The resulting custom actions and workflows are described below.</p>
<h3 id="custom-github-actions">Custom GitHub actions</h3>
<p>Four re-usable custom actions are available:</p>
<ul>
<li><code>pre-commit</code>: runs all pre-commit hooks except <code>no-commit-to-branch</code> as this would
   make merge pipelines fail. In workflows (see below) all jobs depend on this action
   succeeding.</li>
<li><code>sys-check</code>: runs Django's system checks (<code>manage.py check</code>).</li>
<li><code>test</code>: runs all unit tests via the <code>just test</code> recipe (see <a href="#-justfile">Justfile</a> for
   details).</li>
<li><code>containerise</code>: builds a container image and pushes it to the specified registry. Accepts
  a list of platforms to build for, a list of tags and the path to a Dockerfile.</li>
</ul>
<p>See <a href="https://github.com/albertomh/djereo/tree/main/template/%7B%25if%20is_github_project%25%7D.github%7B%25endif%25%7D/actions" target="\&quot;_blank&quot;">.github/actions/</a>
for the definitions of these actions.</p>
<h3 id="github-actions-workflows">GitHub Actions workflows</h3>
<p>Four workflows are defined:</p>
<h4 id="pr-pull-request"><code>PR</code> (pull request)</h4>
<p>Runs whenever a pull request is opened against a branch or an existing PR receives new commits.</p>
<h4 id="ci-continuous-integration"><code>CI</code> (continuous integration)</h4>
<p>As with <code>PR</code>, but acts when a pull request is closed and changes merged into the <code>main</code> branch.</p>
<h4 id="release-please">Release Please</h4>
<p>Refreshes a pull request that updates the changelog &amp; bumps the Semantic Version every
time the <code>main</code> branch is merged to.<br />
<a href="https://github.com/albertomh/djereo/blob/main/template/%7B%25if%20is_github_project%25%7D.release-please-config.json%7B%25endif%25%7D.jinja" target="\&quot;_blank&quot;">.release-please-config.json</a>
configures the tool while <a href="https://github.com/albertomh/djereo/blob/main/template/%7B%25if%20is_github_project%25%7D.release-please-manifest.json%7B%25endif%25%7D.jinja" target="\&quot;_blank&quot;">.release-please-manifest.json</a>
is the source of truth for the latest SemVer tag.</p>
<p><strong>N.B.</strong> conventional commits (as enforced by the relevant git hook) are a prerequisite
for Release Please to generate changelogs and calculate new SemVer tags.</p>
<p>In order for Release Please to automate the above process, a GitHub Actions 'repository secret'
called <code>RELEASE_PLEASE_TOKEN</code> must exist in GitHub (under <repo>/secrets/actions).
The contents of this secret must be a Personal Access Token (PAT) with the following permissions:</p>
<pre><code class="language-yaml">contents: write
pull-requests: write
</code></pre>
<p>For more information, consult the <a href="https://github.com/googleapis/release-please-action" target="\&quot;_blank&quot;">release-please-action project</a>.</p>
<h4 id="dependabot">Dependabot</h4>
<p>Configured to update Python dependencies &amp; GitHub actions on a weekly schedule.</p>
<p>See <a href="https://github.com/albertomh/djereo/tree/main/template/%7B%25if%20is_github_project%25%7D.github%7B%25endif%25%7D/workflows" target="\&quot;_blank&quot;">.github/workflows/</a>
and <a href="https://github.com/albertomh/djereo/blob/main/template/%7B%25if%20is_github_project%25%7D.github%7B%25endif%25%7D/dependabot.yaml" target="\&quot;_blank&quot;">.github/dependabot.yaml</a>
for the definitions of these workflows.</p>
<h2 id="justfile">🤖 Justfile</h2>
<p>Four recipes are ready to use in every new project. Each takes care of setting up a
virtualenv and installing dependencies (including the project itself in editable mode).</p>
<ul>
<li><code>manage</code>: wrapper around Django's <code>manage.py</code>. Takes one or more arguments, which
  defaults to 'help'.</li>
<li><code>runserver</code>: execute Django's <code>runserver</code> management command using Python in
  <a href="https://docs.python.org/3/library/devmode.html" target="\&quot;_blank&quot;">Development Mode</a>.
  This mode shows additional warnings (Deprecation, Import, Resource) and enables extra
  debug hooks. Development Mode can be disabled by passing an empty string
  i.e. <code>just runserver ""</code></li>
<li><code>shell</code>: run Django's management command to drop into a shell. By default this is IPython
  in all new projects.</li>
<li><code>test</code>: install test dependencies, run all unit tests via Django's test runner and
  generate and display a coverage report (both on-screen and in HTML format).</li>
</ul>
<h2 id="developer-experience-enhancements">💻 Developer Experience enhancements</h2>
<h3 id="use-ipython-as-your-shell">Use IPython as your shell</h3>
<p><code>IPython</code>, an improved Python shell, is installed as a development dependency. Django picks
it up by default and uses it instead of the default Python shell. Access it directly with
the <code>just shell</code> recipe.</p>
<p>By default IPython's debugger (<code>ipdb</code>) will launch when a <code>breakpoint()</code> is reached while
running the application.
<code>ipdb</code> is also used to debug tests and will launch when a test fails. The file <code>.pdbrc</code>
contains aliases that can be used in <code>ipdb</code> debugger sessions.</p>
<h3 id="developer-tools">Developer tools</h3>
<p>The project comes with some ready-to-use developer tools installed as dev dependencies and
configured for use locally:</p>
<ul>
<li><a href="https://pypi.org/project/django-browser-reload/" target="\&quot;_blank&quot;">django-browser-reload</a>:
  watch project files for changes and reload the browser.</li>
<li><a href="https://pypi.org/project/django-debug-toolbar/" target="\&quot;_blank&quot;">django-debug-toolbar</a>:
  display information about the request/response cycle on each page.</li>
<li><a href="https://pypi.org/project/rich/" target="\&quot;_blank&quot;">rich</a>: nicer formatting and colours
  for <code>runserver</code> logs.</li>
</ul>
<h3 id="custom-system-checks">Custom system checks</h3>
<p><code>djereo</code> adds two custom system checks that run when the <code>check</code> management command is
invoked.</p>
<ul>
<li><code>check_dev_mode</code>: alerts to the application running in debug mode yet Python's Development
  Mode not being enabled, indicating that there are some warnings and debug hooks you may
  be missing out on.</li>
<li><code>check_model_names</code>: enforces consistent model names across the application.</li>
</ul>
<p>The <code>sys-check</code> GitHub action will run the default Django checks and the above custom
checks as part of the continuous integration pipeline.</p>
<p>While strictly speaking not a system test, the <code>django-linear-migrations</code> package is enabled
on all projects generated by <code>djereo</code>. This package updates a <code>max_migration.txt</code> file
whenever <code>makemigrations</code> runs, triggering a merge conflict if there is an attempt to apply
a non-linear migration history.</p>
<h3 id="use-project-metadata-in-the-django-app">Use project metadata in the Django app</h3>
<p><code>{{project_name}}/__init__.py</code> exposes project metadata such as version and author information.
To use it in a view:</p>
<pre><code class="language-python">from django.http import HttpResponse

from {{project_name}} import __version__


def view(request):
    return HttpResponse(f&quot;on version v{__version__}&quot;)
</code></pre>
<h2 id="settingspy">⚙️ settings.py</h2>
<p><code>settings.py</code> takes values for certain configuration options from environment variables,
managed via the <code>environs</code> package. When no values are specified, it falls back to sensible
defaults.</p>
<p><code>settings.py</code> is divided into five sections:</p>
<ul>
<li><strong>Setup</strong><br />
  Settings such as determining whether the application is running under test conditions or
  defining the <code>BASE_DIR</code>.</li>
<li><strong>Django Core Settings</strong><br />
<code>INSTALLED_APPS</code> is defined by combining three lists containing apps according to their
  provenance. <code>LOGGING</code> is configured to use <code>rich</code> when DEBUG is True and <code>structlog</code>
  otherwise.</li>
<li><strong>Django Contrib Settings</strong><br />
  [<em>left empty for the user to populate</em>]</li>
<li><strong>Third Party Settings</strong><br />
  Settings for <code>django-allauth</code> and dev tools such as the debug toolbar and <code>django-version-checks</code>.</li>
<li><strong>Project Settings</strong><br />
  [<em>left empty for the user to populate</em>]</li>
</ul>
<p>The <code>tool.ruff.lint.flake8-tidy-imports.banned-api</code> table in <code>pyproject.toml</code> includes
configuration to have the <code>ruff</code> pre-commit hook enforce a ban on importing the <code>settings</code>
module directly. It suggests that you use <code>from django.conf import settings</code> instead as
this is safer and avoids complications if <code>override_settings</code> is used in tests.</p>
<h2 id="logging">🪵 Logging</h2>
<p>Logging differs between hosted environments (eg. production) and development.</p>
<p>In development (<code>runserver</code>) <a href="https://pypi.org/project/rich/" target="\&quot;_blank&quot;">rich</a> is
used to output coloured logs:</p>
<p><img alt="runserver logs for a project generated using djereo" src="../media/djereo_runserver-logs.png" /></p>
<p>When <code>DEBUG=False</code>, as in production, <a href="https://www.structlog.org/" target="\&quot;_blank&quot;">structlog</a>
is used instead.</p>
<p>Logging configuration is dynamically generated based on the <code>DEBUG</code> environment variable.
The <code>LoggingConfigFactory</code> class is used to generate settings for filters, formaters,
handlers and loggers.</p>
<h2 id="models">Models</h2>
<p>The core app defines an <code>UuidModel</code> abstract model. Models that subclass it will have
a UUID as a primary key instead of the default <code>BigAutoField</code>. This is used by the models
in the existing 'users' app and can be used by any new models you create.</p>
<p>Utility abstract models <code>CreatedAtModel</code>, <code>UpdatedAtModel</code> and <code>DeletedAtModel</code> (for
soft-deletion) are available to store timestamps.</p>
<h2 id="postgres-database">🐘 Postgres database</h2>
<p><code>djereo</code> projects are configured to use a <code>postgres</code> database out-of-the-box.</p>
<p>This can easily be switched to use a SQLite database instead by changing a single line in
the dotenv template, <code>.env.in</code>.</p>
<h3 id="set-up-tear-down-scripts">Set up &amp; tear down scripts</h3>
<p>The <code>_db/</code> directory contains the following database scripts:</p>
<ul>
<li><code>set_up.sql</code> creates a postgres user and database with the same name as the project.</li>
<li><code>tear_down.sql</code> undoes <code>set_up.sql</code> and removes the database and user.</li>
</ul>
<p>Django's default test database behaviour (creating a new database with a name formed by
prepending the name of the default database with <code>test_</code>) is left as-is.</p>
<h3 id="database-connection-string">Database connection string</h3>
<p>The database connection is configured in <code>settings.py</code> using the <code>environs</code> package's
'Django database URL' extension. That is, as a single database connection string that is
located in <code>.env</code> as the environment variable <code>DATABASE_URL</code>.</p>
<h3 id="connection-pooling">Connection pooling</h3>
<p>Djereo takes advantage of Django's built-in support for postgres connection pooling (<a href="https://docs.djangoproject.com/en/5.1/ref/databases/#connection-pool" target="\&quot;_blank&quot;">Django docs</a>).
While this is a premature optimisation for most projects, the overhead of opening a new
postgres connection is considerable, so connection pooling is enabled to alleviate this.</p>
<h3 id="seed_database-management-command"><code>seed_database</code> management command</h3>
<p>A <code>seed_database</code> management command is included for quickstart purposes and as a starting
point for you to populate with models needed for local development as your application grows.</p>
<p>In a new project <code>seed_database</code> creates three users: admin, staff and a non-privileged
regular user.</p>
<p>Invoke it with <code>just manage seed_database</code>.</p>
<h2 id="user-authentication">🆔 User authentication</h2>
<p>Projects generated with <code>djereo</code> follow the 'custom User + UserProfile' pattern common in
modern Django apps. Authentication functionality is implemented via the <a href="https://allauth.org/" target="\&quot;_blank&quot;">django-allauth</a>
package for simplicity and to ease future extensibility. A dedicated Django app, <code>users</code>,
centralises models, template overrides and configuration for auth-related features.</p>
<h3 id="users-app-model-factories"><code>users</code> app model factories</h3>
<p>Model factories for <code>AuthUser</code> and <code>UserProfile</code> are provided as a convenience. This includes
subfactories to keep tests lean. This means that in a test one may generate a fleshed-out
user with:</p>
<pre><code class="language-python">from users.factories import UserProfileFactory  
from users.models import AuthUser

profile = UserProfileFactory()

assert isinstance(up.user, AuthUser)
</code></pre>
<!-- markdownlint-disable MD013 line-length -->
<h2 id="frontend"><img src="https://simpleicons.org/icons/htmx.svg" width="25" alt="HTMX logo"> Frontend</h2>
<!-- markdownlint-enable MD013 line-length -->

<h3 id="default-pages-styling">Default pages &amp; styling</h3>
<p>Generated projects include a vendorised copy of <a href="https://andybrewer.github.io/mvp/" target="\&quot;_blank&quot;">mvp.css</a>.
This is used to style the default welcome page and the templates used by <code>django-allauth</code>
for the pages under <code>/accounts/</code>.</p>
<h4 id="styling-django-allauth-templates">Styling <code>django-allauth</code> templates</h4>
<p>See the section on <a href="https://docs.allauth.org/en/latest/common/templates.html#styling-the-existing-templates" target="\&quot;_blank&quot;">Styling Existing Templates</a>
in the <code>django-allauth</code> docs for instructions on doing so. Out of the box <code>djereo</code> keeps
changes minimal, only overriding <code>django-allauth</code>'s base template (<code>users/templates/allauth/layouts/base.html</code>).</p>
<h3 id="optional-htmx-frontend">Optional <code>htmx</code> frontend</h3>
<p>Projects generated using <code>djereo</code> include a vendorised copy of <code>htmx</code> in the static files
directory and loaded in the <code>_base.html</code> template. You can opt out from this when
completing the setup questionnaire.</p>
<p>The <code>django-htmx</code> package is used to smoothly integrate <code>htmx</code> into projects, abstracting
away header checks and allowing views to change their behaviour and responses based on the
<code>request.htmx</code> attribute.</p>
<p>See the <a href="https://django-htmx.readthedocs.io/en/latest/index.html">django-htmx documentation</a>
for more.</p>
<h2 id="third-party-packages">🤝 Third-party packages</h2>
<h3 id="whitenoise">whitenoise</h3>
<p><a href="https://whitenoise.readthedocs.io/en/stable/" target="\&quot;_blank&quot;">whitenoise</a> is included
as a dependency. It is configured to serve static files using Brotli compression and add
unique hashes to filenames so that each version can be cached for a long time.</p>
<h2 id="security">🔒 Security</h2>
<p><code>settings.py</code> is configured to detect whether the application is running in a hosted
environment and enable security enhancements. A hosted environment is detected by checking
that <code>DEBUG</code> is False and that localhost is not amongst the <code>CSRF_TRUSTED_ORIGINS</code>.</p>
<ul>
<li>Strict-Transport-Security: this header is enabled via the <code>SECURE_HSTS_*</code> settings.
  Configured for a duration of 3600 seconds to begin with, it is recommended this is
  increased to 2592000 seconds (30 days).</li>
<li>Content-Security-Policy: <a href="https://django-csp.readthedocs.io/en/latest/index.html" target="\&quot;_blank&quot;">django-csp</a>
  is used to set this header to a locked-down default.</li>
<li><code>SECURE_SSL_REDIRECT</code> is not set explicitly under the assumption that the application
  will sit behind a reverse proxy that will take care of redirecting HTTP to HTTPS.
  <code>SECURE_PROXY_SSL_HEADER</code> is also configured to ease this.</li>
<li><a href="https://pypi.org/project/django-permissions-policy/" target="\&quot;_blank&quot;">django-permissions-policy</a>
  is used to apply sensible restrictions to block annoying &amp; intrusive web APIs. See the
  <code>PERMISSIONS_POLICY</code> setting for details.</li>
<li>Cross-Origin-Opener-Policy: by default Django sets this to the secure <code>same-origin</code> value.</li>
<li>Cross-Origin-Embedder-Policy &amp; Cross-Origin-Resource-Policy: these are set to their most
  secure values by means of a custom middleware, <code>SecurityHeadersMiddleware</code>. There is an
  open ticket to add these to Django (<a href="https://code.djangoproject.com/ticket/31923" target="\&quot;_blank&quot;">#31923</a>).</li>
</ul>
<h2 id="tests">🧪 Tests</h2>
<p><code>djereo</code> projects come with all the tooling needed to get you writing tests quickly, as
well as a couple of tests ready out-of-the-box.</p>
<p>The <code>PendingMigrationsTests</code> class will fail if any model changes are not yet captured in
a migration, with the aim of negating the possibility of a deployment attempt that fails
due to missing migrations.</p>
<p>The <code>test_checks</code> module tests the custom Django system checks added by <code>djereo</code>.</p>
<p>To run these tests use the recipe <code>just test</code>, passing the same optional arguments you
would when using <code>manage.py test</code> e.g. <code>just test package.module</code>.</p>
<h2 id="deployment">🚀 Deployment</h2>
<p>While <code>djereo</code> eschews Docker throughout development, the advantages of containerisation
for tagged, reproducible builds in hosted environments are evident.</p>
<p>The <code>_deploy/</code> directory of projects generated with <code>djereo</code> includes a Dockerfile that
uses the local development toolchain (the <code>uv</code> project manager) to containerise web
applications.</p>
<p>The Dockerfile runs pre-production steps, such as enabling bytecode compilation to trade a longer
installation time for faster start-up times, or running Django's <code>collectstatic</code> command.
The container's entrypoint runs <a href="https://docs.gunicorn.org/en/latest/index.html" target="\&quot;_blank&quot;">gunicorn</a>
as the WSGI web server to make the Django application available.</p>
<p>The resulting container has been tested in production behind <a href="https://nginx.org/en/docs/index.html" target="\&quot;_blank&quot;">nginx</a>
as the reverse proxy, with <code>gunicorn</code> as the WSGI web server. <code>nginx</code> configuration and
setting up SSL certificates is beyond the scope of <code>djereo</code>, but hopefully the Docker image
provides a head-start on deploying applications generated by <code>djereo</code>.</p>
<p><code>gunicorn</code> is included as a dependency of all <code>djereo</code> projects. If you are interested in
using ASGI instead of WSGI, check out <a href="https://www.uvicorn.org/">uvicorn</a>.</p>
<h3 id="healthchecks">Healthchecks</h3>
<p>Generated projects pull in <a href="https://github.com/lincolnloop/django-alive" target="\&quot;_blank&quot;">django-alive</a>
to expose two endpoints with which to monitor the health of an application instance:</p>
<ul>
<li><code>/-/alive/</code></li>
<li><code>/-/health/</code></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quickstart/" class="btn btn-neutral float-left" title="Quickstart"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../develop/" class="btn btn-neutral float-right" title="Developer docs">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/albertomh/djereo" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../develop/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
